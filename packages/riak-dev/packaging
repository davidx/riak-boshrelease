#!/usr/bin/env bash

set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables
set +x

RIAK_VERSION=1.1.4

PATH=/var/vcap/packages/erlang/bin:$PATH
tar xzf riak/riak-${RIAK_VERSION}.tar.gz

cd riak-${RIAK_VERSION}

make rel

# https://wiki.basho.com/Building-a-Development-Environment.html
# make 4 copies of riak:
# - dev/dev1
# - dev/dev2
# - dev/dev3
# - dev/dev4
make devrel

# output is in dev1/riak, dev2/riak, dev3/riak, dev4/riak
cp -prv dev/* ${BOSH_INSTALL_TARGET}
